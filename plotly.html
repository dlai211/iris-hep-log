
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Laser Precipitation Monitor Plotly Plots</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
        <link rel="stylesheet" href="style_plotly.css">
    </head>
    <body>
        <h1>Comparison ACTS vs. tracking calculator Plotly Plot</h1>

        <nav id="cut-nav"> 
            <ul id="cut-links"></ul>
        </nav>

        <!-- performance or selection plots -->
        <nav id="mode-nav">
        </nav>

        <!-- Section to display images -->
        <section>
            <h2 id="cut-title">Adjust the sliders to see the effect on the tracking resolution calculation
            </h2>
            <div class="wrapper" id="image-container">
                <!-- Images will be dynamically added here -->
            </div>
        </section>

        <!-- Modal for Fullscreen Image -->
        <div id="image-modal" class="modal">
            <span class="close">&times;</span>
            <img class="modal-content" id="modal-img">
        </div>

        
        <div class="plot-wrapper" data-container="datetime_container">
        <div id="datetime_container" class="plot-container">

            <!-- Controls (centered) -->
            <div class="ctrls">
            <div class="ctrl">
                <label>Δwidth (x/X0)
                <input id="w" type="range" min="0" max="4" step="1" value="2">
                </label>
                <span class="val" id="wval">0.000000</span>
            </div>

            <div class="ctrl">
                <label>Δres (m)
                <input id="r" type="range" min="0" max="4" step="1" value="2">
                </label>
                <span class="val" id="rval">0.00e+0</span>
            </div>

            <div class="ctrl">
                <label>Δpos (m)
                <input id="p" type="range" min="0" max="4" step="1" value="2">
                </label>
                <span class="val" id="pval">0.000000</span>
            </div>
            </div>

            <!-- Your existing Plotly figure (kept verbatim) -->
            <div>
            <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
            <script charset="utf-8" src="https://cdn.plot.ly/plotly-3.1.0.min.js" integrity="sha256-Ei4740bWZhaUTQuD6q9yQlgVCMPBz6CZWhevDYPv93A=" crossorigin="anonymous"></script>
            <div id="tracking_res_plot" class="plotly-graph-div" style="height:700px; width:1100px;"></div>
            <!-- ******* BEGIN: your existing Plotly.newPlot(...) exactly as you pasted ******* -->
            <script type="text/javascript">
                window.PLOTLYENV = window.PLOTLYENV || {};
                if (document.getElementById("tracking_res_plot")) {
                Plotly.newPlot(
                    "tracking_res_plot",
                    [/* … your 10 traces JSON … */],
                    {/* … your layout JSON … */},
                    {"responsive": true}
                )
                };
            </script>
            <!-- ******* END: your existing Plotly.newPlot(...) ******* -->
            </div>

            <!-- Precomputed calculator grid (embed as JSON) -->
            <script id="calc-grid" type="application/json">
        __CALC_GRID_JSON__
            </script>

            <!-- Slider logic (updates only "Calculator" traces) -->
            <script>
            // Must match the order of the 5 panels
            const LABELS = ['sigma(d)', 'sigma(z)', 'sigma(phi)', 'sigma(theta)', 'sigma(pt)/pt'];

            // Discrete slider stops (you can change these)
            const W_LIST = [-0.010, -0.005, 0.0, 0.005, 0.010];   // Δwidth (x/X0)
            const R_LIST = [-2e-6,  -1e-6,  0.0, 1e-6,  2e-6];     // Δres (m)
            const P_LIST = [-1e-3,  -5e-4,  0.0, 5e-4,  1e-3];     // Δpos (m)

            // Read the precomputed grid (keyed by "iw|ir|ip")
            const CALC_GRID = JSON.parse(document.getElementById('calc-grid').textContent.trim());

            // Find indices of the "Calculator" traces in the figure
            const gd = document.getElementById('tracking_res_plot');
            function findCalculatorTraceIndices() {
                const idx = [];
                (gd.data || []).forEach((tr, i) => {
                if (tr && tr.name === 'Calculator') idx.push(i);
                });
                return idx;
            }
            const CALC_TRACE_IDX = findCalculatorTraceIndices(); // should be 5 indices

            // UI wiring
            const elW = document.getElementById('w');
            const elR = document.getElementById('r');
            const elP = document.getElementById('p');
            const outW = document.getElementById('wval');
            const outR = document.getElementById('rval');
            const outP = document.getElementById('pval');

            function update() {
                const iw = +elW.value;
                const ir = +elR.value;
                const ip = +elP.value;

                // show current numeric values
                outW.textContent = W_LIST[iw].toFixed(6);
                outR.textContent = Number(R_LIST[ir]).toExponential(2);
                outP.textContent = P_LIST[ip].toFixed(6);

                const key = iw + '|' + ir + '|' + ip;
                const cur = CALC_GRID[key];
                if (!cur) return;

                // Update the y-arrays of the 5 "Calculator" traces
                CALC_TRACE_IDX.forEach((tIdx, panelIdx) => {
                const y = cur[LABELS[panelIdx]];
                Plotly.restyle(gd, { y: [y] }, [tIdx]);
                });
            }

            // Attach events
            elW.addEventListener('input', update);
            elR.addEventListener('input', update);
            elP.addEventListener('input', update);

            // Initial readout/update (centered controls: value="2" above)
            update();
            </script>

        </div>
        </div>

        
    </body>
    </html>
    